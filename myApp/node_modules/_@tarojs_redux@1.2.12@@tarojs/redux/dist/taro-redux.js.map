{"version":3,"file":"taro-redux.js","sources":["../src/utils/store.js","../../taro-utils/dist/index.js","../src/utils/index.js","../src/connect/connect.js","../src/connect/Provider.js","../src/index.js"],"sourcesContent":["let store = null\n\nexport function getStore () {\n  return store\n}\n\nexport function setStore (arg) {\n  store = arg\n}\n","/* eslint-disable */\nObject.is = Object.is || function (x, y) {\n  if (x === y) {\n    return x !== 0 || 1 / x === 1 / y;\n  }\n\n  return x !== x && y !== y;\n};\n\nfunction shallowEqual(obj1, obj2) {\n  if (obj1 === null && obj2 === null) {\n    return true;\n  }\n\n  if (obj1 === null || obj2 === null) {\n    return false;\n  }\n\n  if (Object.is(obj1, obj2)) {\n    return true;\n  }\n\n  var obj1Keys = obj1 ? Object.keys(obj1) : [];\n  var obj2Keys = obj2 ? Object.keys(obj2) : [];\n\n  if (obj1Keys.length !== obj2Keys.length) {\n    return false;\n  }\n\n  for (var i = 0; i < obj1Keys.length; i++) {\n    var obj1KeyItem = obj1Keys[i];\n\n    if (!obj2.hasOwnProperty(obj1KeyItem) || !Object.is(obj1[obj1KeyItem], obj2[obj1KeyItem])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction addLeadingSlash(path) {\n  return path.charAt(0) === '/' ? path : '/' + path;\n}\n\nfunction getCurrentPageUrl() {\n  var pages = getCurrentPages();\n  var currentPage = pages[pages.length - 1];\n  return addLeadingSlash(currentPage.route || currentPage.__route__);\n}\n\nvar index = {\n  shallowEqual: shallowEqual,\n  getCurrentPageUrl: getCurrentPageUrl\n};\n\nexport default index;\nexport { shallowEqual, getCurrentPageUrl };\n//# sourceMappingURL=index.js.map\n","export function isObject (arg) {\n  return arg != null && typeof arg === 'object' && !Array.isArray(arg)\n}\n\nexport function mergeObjects (obj1, obj2) {\n  const result = Object.assign({}, obj1)\n  if (isObject(obj1) && isObject(obj2)) {\n    for (const p in obj2) {\n      if (isObject(obj1[p]) && isObject(obj2[p])) {\n        result[p] = mergeObjects(obj1[p], obj2[p])\n      } else {\n        result[p] = obj2[p]\n      }\n    }\n  }\n  return result\n}\n","import { shallowEqual } from '@tarojs/utils'\n\nimport { getStore } from '../utils/store'\nimport { mergeObjects, isObject } from '../utils'\n\nfunction isEqual (a, b) {\n  const typeA = typeof a\n  const typeB = typeof b\n  if (typeA !== typeB) {\n    return false\n  }\n  if (typeA === 'object') {\n    return shallowEqual(a, b)\n  }\n  return a === b\n}\n\nfunction wrapPropsWithDispatch (mapDispatchToProps, dispatch) {\n  if (typeof mapDispatchToProps === 'function') {\n    return mapDispatchToProps(dispatch)\n  }\n\n  if (isObject(mapDispatchToProps)) {\n    return Object.keys(mapDispatchToProps)\n      .reduce((props, key) => {\n        const actionCreator = mapDispatchToProps[key]\n        if (typeof actionCreator === 'function') {\n          props[key] = (...args) => dispatch(actionCreator(...args))\n        }\n        return props\n      }, {})\n  }\n\n  return {}\n}\n\nexport default function connect (mapStateToProps, mapDispatchToProps) {\n  const store = getStore()\n  const dispatch = store.dispatch\n  const initMapDispatch = wrapPropsWithDispatch(mapDispatchToProps, dispatch)\n  initMapDispatch.dispatch = dispatch\n\n  const stateListener = function () {\n    let isChanged = false\n    const newMapState = mapStateToProps(store.getState(), this.props)\n    const prevProps = Object.assign({}, this.props)\n    Object.keys(newMapState).forEach(key => {\n      let val = newMapState[key]\n      if (isObject(val) && isObject(initMapDispatch[key])) {\n        val = mergeObjects(val, initMapDispatch[key])\n      }\n      if (!isEqual(this.props[key], val)) {\n        this.props[key] = val\n        isChanged = true\n      }\n    })\n    if (isChanged) {\n      this.prevProps = prevProps\n      this._unsafeCallUpdate = true\n      this.forceUpdate(() => {\n        delete this._unsafeCallUpdate\n      })\n    }\n  }\n\n  return function connectComponent (Component) {\n    // 将从redux而来的props从配置中剔除\n    const mapState = mapStateToProps(store.getState(), Component.defaultProps || {})\n    Component.properties && mapState && Object.keys(mapState).forEach(function (key) {\n      delete Component.properties[key]\n    })\n\n    let unSubscribe = null\n    return class Connect extends Component {\n      constructor (props) {\n        super(Object.assign(...arguments, mergeObjects(mapStateToProps(store.getState(), props), initMapDispatch)))\n        Object.keys(initMapDispatch).forEach(key => {\n          this[`__event_${key}`] = initMapDispatch[key]\n        })\n      }\n\n      componentWillMount () {\n        const store = getStore()\n        Object.assign(this.props, mergeObjects(mapStateToProps(store.getState(), this.props), initMapDispatch))\n        unSubscribe = store.subscribe(stateListener.bind(this))\n        if (super.componentWillMount) {\n          super.componentWillMount()\n        }\n      }\n\n      componentWillUnmount () {\n        if (super.componentWillUnmount) {\n          super.componentWillUnmount()\n        }\n        if (unSubscribe) {\n          unSubscribe()\n        }\n        unSubscribe = null\n      }\n    }\n  }\n}\n","export default class Provider {}\n","import { getStore, setStore } from './utils/store'\nimport connect from './connect/connect'\nimport Provider from './connect/Provider'\n\nexport default {\n  connect,\n  Provider,\n  getStore,\n  setStore\n}\n\nexport {\n  connect,\n  Provider,\n  getStore,\n  setStore\n}\n"],"names":["store","getStore","setStore","arg","Object","x","y","obj1","obj2","obj1Keys","obj2Keys","i","obj1KeyItem","isObject","Array","isArray","mergeObjects","result","assign","p","isEqual","a","b","typeA","typeB","shallowEqual","wrapPropsWithDispatch","mapDispatchToProps","dispatch","keys","reduce","props","key","actionCreator","connect","mapStateToProps","initMapDispatch","stateListener","isChanged","newMapState","getState","prevProps","forEach","val","_unsafeCallUpdate","forceUpdate","connectComponent","Component","mapState","defaultProps","properties","unSubscribe","arguments","subscribe","bind","Provider"],"mappings":"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"}